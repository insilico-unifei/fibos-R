---
editor_options: 
  markdown: 
    wrap: sentence
---

# FIBOS R (BETA)

The Occluded Surface (OS) algorithm is a widely used approach for analyzing atomic packing in biomolecules. 
Here, we introduce **FIBOS**, an R and Python package that extends the OS methodology with enhancements. 
It integrates efficient Fortran code from the original OS implementation and introduces an innovation: 
the use of Fibonacci spirals for surface point distribution. This modification reduces anisotropy and 
ensures a more uniform and even distribution of surface dots, improving the accuracy
of the algorithm.

Python fibos version: https://github.com/insilico-unifei/fibos-py.git.

## Operating Systems

FIBOS was designed to be multiplatform and run on Linux, Windows and Mac.
However, it has been tested on the following versions:

- **Linux**: Ubuntu ($\geq$ 20.04)
- **Windows**: Windows 11
- **Mac**: MacOS 15.0.1


## Instalation

On Windows, install RTools:
```
https://cran.r-project.org/bin/windows/Rtools/
```

Also on Windows, set as administrator the PATH to the R bin folder:
(x.x.x with the actual version number of your R installation)
```
setx PATH "%PATH%;C:\Program Files\R\R-x.x.x\bin"

```

These additional packages may be required:
```         
install.packages("tidyverse", "bio3d", "fs", "furrr")
```

Install fibos:

```         
install.packages("devtools"")
library("devtools")
install_github("https://github.com/insilico-unifei/fibos-R.git") 
```

## Main functions:

1.  **`occluded_surface(pdb, method = "FIBOS")`**: Implements the Occluded Surface 
algorithm, generating points, areas, and normals for each atom. It accepts the path 
to a PDB file and a method selection — either the classic 'OS' or the default 'FIBOS'. 
The function returns the results as a table (tibble) and creates a file named 
prot_PDBid.srf in the fibos_file directory.

1.  **`osp(file)`**: Implements the Occluded Surface Packing (OSP) metric for 
each residue. Accepts a path to an .srf file generated by occluded_surface as a 
parameter and returns the results as a table (tibble) summarized by residue. 

### Quickstart:

```  
library(fibos)

# Calculate FIBOS per atom and create .srf files in fibos_files folder
pdb_fibos <- occluded_surface("1fib", method = "FIBOS")

# Show first 3 rows of pdb_fibos table
print(pdb_fibos |> utils::head(3))

# A tibble: 3 × 6
#   ATOM                       NUMBER_POINTS  AREA RAYLENGTH DISTANCE
#   <chr>                              <int> <dbl>     <dbl>    <dbl>
# 1 GLN    1@N___>HIS   3@NE2_             6  1.29     0.791     5.49
# 2 GLN    1@N___>HIS   3@CE1_             1  0.2      0.894     6.06
# 3 GLN    1@N___>HIS   3@CG__             1  0.16     0.991     6.27

# Calculate OSP metric per residue from .srf file in fibos_files folder
pdb_osp <- osp("fibos_files/prot_1fib.srf")

# Show first 3 rows of pdb_osp table
print(pdb_osp |> utils::head(3) )

# A tibble: 3 × 5
#   Resnum Resname    OS `os*[1-raylen]`   OSP
#    <dbl> <chr>   <dbl>           <dbl> <dbl>
# 1      1 GLN      36.8            22.0 0.157
# 2      2 ILE      49.4            36.2 0.317
# 3      3 HIS      64.2            43.2 0.335
``` 

### A more complex example:

```         
library(tidyverse)
library(bio3d)
library(fs)
library(furrr)
library(fibos)

# source of PDB files
folder <- "PDB"

# Create PDB folder if it does not exist
if (!dir.exists(folder)) fs::dir_create(folder)

# PDB ids list
pdb_ids = c("8RXN","1ROP") 

# Get PDB files from RCSB and put them into the PDB folder 
pdb_paths <- pdb_ids |> bio3d::get.pdb(path = folder) 

# Save default environment variable "mc.cores" to recover later
my_default_mccores = getOption("mc.cores")

# Detect number of physical cores and update "mc.cores"
my_true_mccores = parallel::detectCores()
options(mc.cores = my_true_mccores)

# Calculate in parallel FIBOS per atom per PDBid 
# Create .srf files in fibos_files folder
# Return FIBOS tables in pdb_fibos list
plan(multisession, workers = my_true_mccores)
pdb_fibos <- pdb_paths |> furrr::future_map(\(x) occluded_surface(x, method = "FIBOS"), 
                                           .options = furrr_options(seed = 123))
# Recover default "mc.cores"
options(mc.cores = my_default_mccores)

# Show first 3 rows of first pdb_fibos table
pdb_fibos[[1]] |> utils::head(3)

# Prepare paths for the generated .srf files in folder fibos_files
srf_paths <- pdb_ids |> map(\(x) fs::path("fibos_files", paste0("prot_",x), 
                                          ext = "srf")) |> unlist()

# Calculate OSP metric by residue
# Return OSP tables in pdb_osp list
pdb_osp <- srf_paths |> purrr::map(\(x) osp(x))

# Show first 3 rows of the first pdb_osp table
pdb_osp[[1]] |> utils::head(3)

# Rename the fibos_files folder to preserve it and prevent overwriting
file.rename("fibos_files","fibos_files_test")
```

### Case study:
[Here](https://github.com/insilico-unifei/fibos-R-case-study-supp.git) we show a 
case study  (currently only in R), aiming to compare the packing density between experimentally 
determined structures and the same structures predicted by AlphaFold (AF).

## Authors

-   Carlos Silveira ([carlos.silveira\@unifei.edu.br](mailto:carlos.silveira@unifei.edu.br))\
    Herson Soares ([d2020102075\@unifei.edu.br](mailto:d2020102075@unifei.edu.br))\
    Institute of Technological Sciences,\
    Federal University of Itajubá,\
    Campus Itabira, Brazil.

-   João Romanelli ([joaoromanelli\@unifei.edu.br](mailto:joaoromanelli@unifei.edu.br)) \
    Institute of Applied and Pure Sciences, \
    Federal University of Itajubá, \
    Campus Itabira, Brazil.

-   Patrick Fleming ([Pat.Fleming\@jhu.edu](mailto:Pat.Fleming@jhu.edu)) \
    Thomas C. Jenkins Department of Biophysics, \
    Johns Hopkins University, \
    Baltimore, MD, USA

## References

Fleming PJ, Richards FM. Protein packing: Dependence on protein size, secondary structure and amino acid composition. J Mol Biol 2000;299:487–98.

Pattabiraman N, Ward KB, Fleming PJ. Occluded molecular surface: Analysis of protein packing. J Mol Recognit 1995;8:334–44.

## Status

In Progress.


